{% extends 'layout.html.twig' %}

{% if page_title is not defined %}
    {% set page_title = activity.name %}
{% endif %}

{% block body_root %}
<div class="activity hero row {{ activity.color ?? '' }}">
    {% if activity.image.name %}
        <img src="{{ vich_uploader_asset(activity, 'imageFile') }}" alt="{{ activity.name }}" class="filter">
        <img src="{{ vich_uploader_asset(activity, 'imageFile') }}" alt="{{ activity.name }}" class="over">
    {% endif %}
    <div class="container">
        <h2>{{ activity.name }}</h2>
        {% if activity.start|date('d-m-Y') == activity.end|date('d-m-Y') %}
            <span>{{ activity.start|date('d-m-Y H:i') }} - {{ activity.end|date('H:i') }}</span>
        {% else %}
            <span>{{ activity.start|date('d-m-Y H:i') }} - {{ activity.end|date('d-m-Y H:i') }}</span>
        {% endif %}
        <span>{{ activity.location.address }}</span>
        {% set prices = activity.options|map(p => p.price)|sort %}
        {% if prices|length == 0 %}
            <span>Prijs onbekend</span>
        {% else %}
            <span>&euro; {{ prices|first }}{% if prices|first != prices|last %} - &euro; {{ prices|last }}{% endif %}</span>
        {% endif %}
        <span>{{ activity.registrations|length }} {{ activity.registrations|length != 1 ? 'aanmeldingen' : 'aanmelding' }} - uiterlijk {{ activity.deadline|date('d-m-Y') }}</span>
        <form action="{{ path("activity_register", { 'id': activity.id }) }}" method="post" class="buttons">
            {% if options|length == 0 %}
                <span class="button confirm disabled">Niet beschikbaar</span>
            {% elseif options|length == 1 %}
                {{ form(options|first.form) }}
                <button class="button confirm" name="single_option" value="{{ activity.options[0].id }}" type="submit">Aanmelden</button>
            {% else %}
                <div class="button confirm grow">
                    <span>Aanmelden</span>
                    <div class="content">
                        <table>
                            <tbody>
                            {% for option in options %}
                                <tr>
                                    <td>{{ option.data.name }}</td>
                                    <td>&euro; {{ option.data.price }}</td>
                                    <td>{{ form(option.form) }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% endif %}
        </form>
    </div>
</div>
<div class="container row">
    <div class="grid-x">
        <div class="cell small-12 medium-8">
            <p>{{ activity.description }}</p>
        </div>
        <div class="cell medium-4 registrations">
            <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Aanmeldingen</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for registration in activity.registrations %}
                            <tr>
                                <td>{{ registration.person.fullname }}</td>
                            </tr>
                        {% else %}
                            <tr>
                                <td>Geen aanmeldingen.</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
